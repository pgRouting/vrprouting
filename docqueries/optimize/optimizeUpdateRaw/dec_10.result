BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
SET search_path TO 'example2', 'public';
SET
CALL initial_solution();
CALL
DROP TABLE IF EXISTS tmp_vehicles;
DROP TABLE
SELECT *
INTO tmp_vehicles
FROM vehicles;
SELECT 180
COMMIT;
COMMIT
SET client_min_messages TO NOTICE;
SET
CALL vrp_optimizeUpdateRaw(
    $$SELECT id, amount, p_id, p_open, p_close, p_service, d_id, d_open, d_close, d_service FROM shipments$$,
    $$SELECT id, capacity, stops, s_id, s_open, s_close, s_service, e_id, e_open, e_close, e_service FROM tmp_vehicles$$,
    $$SELECT start_vid, end_vid, agg_cost FROM timeMatrix$$,
    $$SELECT * FROM tdm_raw('2019-12-10'::TIMESTAMP, '2019-12-13'::TIMESTAMP)$$,
    'tmp_vehicles',
    execution_date => EXTRACT(EPOCH FROM ('2019-12-10 00:00:00'::TIMESTAMP))::BIGINT,
    factor => 1::FLOAT, max_cycles => 1,
    check_triangle_inequality => true,
    subdivision_kind => 1
);
CALL
BEGIN;
BEGIN
SELECT id, s_tw_open, v.stops, t.stops
FROM vehicles v
LEFT JOIN tmp_vehicles t
USING (s_tw_open, id)
WHERE date_trunc('day', s_tw_open) >= '2019-12-10 00:00:00'
ORDER BY s_tw_open, id;
 id  |      s_tw_open      |                                           stops                                           |                                              stops
-----+---------------------+-------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------
 607 | 2019-12-10 08:00:00 | {13,13,37,37}                                                                             | {13,13,37,37}
 611 | 2019-12-10 08:00:00 | {11,11,630,163,18,630,163,611,611,18,181,181}                                             | {300,300,630,163,18,630,163,611,611,18,181,181}
 615 | 2019-12-10 08:00:00 | {4,9,4,9,187,23,591,187,23,591}                                                           | {4,9,4,9,187,23,591,187,23,591}
 619 | 2019-12-10 08:00:00 | {631,551,624,344,341,300,300,631,551,624,344,341,311,169,311,169,553,553,543,543,191,191} | {631,551,624,344,341,11,11,631,551,624,344,341,311,169,311,607,169,607,553,553,543,543,191,191}
 623 | 2019-12-10 08:00:00 | {35,24,24,35,578,578,30,315,30,315,342,346,342,346}                                       | {35,24,24,35,578,578,30,315,30,315,342,346,342,346}
 627 | 2019-12-10 08:00:00 | {124,577,125,126,126,577,124,125,548,548}                                                 | {124,577,125,126,126,577,124,125,548,548}
 631 | 2019-12-10 08:00:00 | {51,51,563,172,335,335,563,172}                                                           | {51,51,563,172,335,335,563,172}
 635 | 2019-12-10 08:00:00 | {132,130,132,130}                                                                         | {132,130,132,130}
 639 | 2019-12-10 08:00:00 | {127,120,127,120,154,33,154,33,607,607,615,615}                                           | {127,120,127,120,154,33,154,33,615,615}
 608 | 2019-12-10 09:40:00 | {62,186,39,39,186,62,36,36,345,345}                                                       | {62,186,39,39,186,62,36,36}
 628 | 2019-12-10 09:40:00 | {27,45,242,239,45,242,239,27,52,52}                                                       | {27,45,242,239,45,242,239,27,52,52}
 616 | 2019-12-10 09:50:00 | {221,38,38,221,25,25,31,31}                                                               | {221,38,38,221,31,31}
 636 | 2019-12-10 09:50:00 | {43,44,43,44}                                                                             | {43,25,44,43,25,44}
 612 | 2019-12-10 10:30:00 | {2,40,40,2,64,64,230,230,336,336}                                                         | {2,345,345,2,64,64,230,230,336,336}
 632 | 2019-12-10 10:30:00 | {46,46,603,603}                                                                           | {46,46,603,603}
 620 | 2019-12-10 10:50:00 | {182,185,185,182,343,316,316,343}                                                         | {182,185,185,182,343,316,316,343}
 640 | 2019-12-10 10:50:00 | {312,312,34,34}                                                                           | {40,40,312,312,34,34}
 624 | 2019-12-10 12:00:00 | {644,642,643,643,644,642}                                                                 | {644,642,643,643,644,642}
 609 | 2019-12-10 13:00:00 | {54,528,54,597,528,597,559,559,12,435,435,12}                                             | {54,528,54,597,528,620,597,620,12,435,435,12}
 617 | 2019-12-10 13:00:00 | {544,460,457,554,63,544,32,460,457,63,554,32,593,560,560,593,600,600,173,29,29,173}       | {544,460,457,554,63,544,32,460,457,63,554,559,32,593,559,593,600,600,173,29,29,173}
 629 | 2019-12-10 13:00:00 | {477,477,620,620,549,595,328,549,328,595}                                                 | {477,477,560,581,560,581,549,595,328,549,328,595}
 637 | 2019-12-10 13:00:00 | {587,587,47,47}                                                                           | {587,587,47,47}
 625 | 2019-12-10 13:50:00 | {581,581,26,26,347,347}                                                                   | {5,5,347,347}
 613 | 2019-12-10 14:00:00 | {170,527,170,621,527,621,622,622}                                                         | {170,527,170,621,527,621,622,622}
 621 | 2019-12-10 14:00:00 | {5,5,606,234,606,231,234,231}                                                             | {26,26,606,234,606,231,234,231}
 633 | 2019-12-10 14:00:00 | {564,604,604,330,329,564,330,329}                                                         | {564,330,329,564,330,329}
 641 | 2019-12-10 14:00:00 | {243,243}                                                                                 | {604,604,243,243}
 610 | 2019-12-10 15:20:00 | {317,317,222,222,10,55,10,55,655,655,21,21,61,61}                                         | {317,317,222,222,10,55,10,55,655,655,21,21}
 630 | 2019-12-10 15:20:00 | {550,550,123,131,123,131,65,562,562,65}                                                   | {550,550,123,131,123,131,65,562,6,562,6,65}
 614 | 2019-12-10 15:30:00 | {}                                                                                        | {}
 618 | 2019-12-10 15:40:00 | {561,561,601,601,153,1,1,613,613,6,153,6}                                                 | {561,561,601,601,153,1,1,592,153,61,592,61}
 638 | 2019-12-10 15:40:00 | {128,579,129,580,129,128,580,579,592,602,22,592,602,22}                                   | {128,579,129,580,129,128,580,579,602,22,602,22}
 626 | 2019-12-10 15:50:00 | {28,28,612,612,540,540,632,632,190,190}                                                   | {28,28,612,612,613,540,613,540,632,632,190,190}
 634 | 2019-12-10 16:00:00 | {133,121,654,121,133,654}                                                                 | {133,121,654,121,133,654}
 622 | 2019-12-10 16:10:00 | {628,164,628,164,623,623}                                                                 | {628,164,628,164,623,623}
 642 | 2019-12-10 16:10:00 | {}                                                                                        | {}
 643 | 2019-12-11 08:00:00 | {165,171,629,165,171,629}                                                                 | {165,171,629,165,171,629}
 647 | 2019-12-11 08:00:00 | {625,625,214,585,214,585,211,211}                                                         | {625,625,214,214,211,211}
 651 | 2019-12-11 08:00:00 | {363,362,246,245,325,363,362,246,245,325}                                                 | {363,362,246,245,325,363,362,246,245,325}
 655 | 2019-12-11 08:00:00 | {213,627,337,627,213,177,337,619,177,586,619,206,338,338,586,206}                         | {213,627,337,627,213,177,337,619,177,586,619,206,338,338,586,206}
 659 | 2019-12-11 08:00:00 | {583,576,583,576,155,155,152,590,541,152,541,590}                                         | {583,576,585,583,576,155,155,585,152,590,541,152,541,590}
 663 | 2019-12-11 08:00:00 | {141,140,141,140,555,568,555,568}                                                         | {141,140,139,139,141,140,555,568,555,568}
 667 | 2019-12-11 08:00:00 | {138,139,139,138,179,157,149,320,320,157,149,179}                                         | {146,138,146,138,179,157,149,320,320,157,149,179}
 671 | 2019-12-11 08:00:00 | {146,146}                                                                                 | {146,146}
 675 | 2019-12-11 08:00:00 | {144,134,144,134,283,174,283,174,188,188}                                                 | {144,134,144,134,283,174,283,174,188,188}
 644 | 2019-12-11 09:40:00 | {545,608,545,608,348,348}                                                                 | {545,608,545,608,571,571,348,348}
 664 | 2019-12-11 09:40:00 | {158,158,556,557,557,556}                                                                 | {556,557,557,556}
 652 | 2019-12-11 09:50:00 | {212,208,212,208}                                                                         | {203,203,212,208,212,208}
 672 | 2019-12-11 09:50:00 | {233,203,203,233,570,570}                                                                 | {233,158,158,233,570,570}
 648 | 2019-12-11 10:30:00 | {617,571,571,617,207,339,339,207,209,209}                                                 | {617,617,207,207,209,209}
 668 | 2019-12-11 10:30:00 | {284,284,189,167,167,189}                                                                 | {284,284,189,167,167,189}
 656 | 2019-12-11 10:50:00 | {202,204,156,204,156,202,235,235}                                                         | {202,204,156,204,156,202,235,235}
 676 | 2019-12-11 10:50:00 | {321,609,609,225,350,321,237,225,350,175,237,175}                                         | {321,609,609,225,350,321,237,225,350,339,175,339,237,175}
 660 | 2019-12-11 12:00:00 | {}                                                                                        | {}
 645 | 2019-12-11 13:00:00 | {542,542,582,582,215,215,273,273}                                                         | {542,542,582,582,215,215,273,273}
 653 | 2019-12-11 13:00:00 | {201,201,196,618,618,584,196,584,178,178}                                                 | {201,201,196,618,618,584,196,584,180,180,178,178}
 665 | 2019-12-11 13:00:00 | {668,546,546,669,669,668,598,598,168,168}                                                 | {668,546,546,669,669,668}
 673 | 2019-12-11 13:00:00 | {569,194,569,194}                                                                         | {569,194,569,194,598,598,195,195}
 661 | 2019-12-11 13:50:00 | {473,473}                                                                                 | {473,473}
 649 | 2019-12-11 14:00:00 | {180,180,216,193,216,193}                                                                 | {216,193,216,193}
 657 | 2019-12-11 14:00:00 | {259,259,430,430}                                                                         | {259,259,430,430}
 669 | 2019-12-11 14:00:00 | {195,599,599,195}                                                                         | {599,599}
 677 | 2019-12-11 14:00:00 | {198,351,496,226,352,198,224,224,496,226,351,352}                                         | {168,168,198,351,496,226,352,198,224,224,496,226,351,352}
 646 | 2019-12-11 15:20:00 | {670,217,672,670,217,673,672,673,184,210,184,210,671,671}                                 | {670,217,672,670,217,673,672,673,184,210,184,210,671,671}
 666 | 2019-12-11 15:20:00 | {240,240,136,136,199,197,160,151,160,151,199,197}                                         | {240,240,136,136,199,197,160,151,160,151,199,197}
 650 | 2019-12-11 15:30:00 | {232,349,232,349,200,200}                                                                 | {232,349,232,349,200,200}
 654 | 2019-12-11 15:40:00 | {274,274,238,260,238,247,260,159,247,159}                                                 | {274,274,238,260,238,247,260,159,247,159}
 674 | 2019-12-11 15:40:00 | {137,145,137,145}                                                                         | {137,145,137,145}
 662 | 2019-12-11 15:50:00 | {176,166,176,166}                                                                         | {176,166,176,166}
 670 | 2019-12-11 16:00:00 | {150,150}                                                                                 | {150,150}
 658 | 2019-12-11 16:10:00 | {}                                                                                        | {}
 678 | 2019-12-11 16:10:00 | {135,147,135,147}                                                                         | {135,147,135,147}
 679 | 2019-12-12 08:00:00 | {340,301,301,340,636,636,605,605}                                                         | {340,301,301,340,636,636,605,605}
 683 | 2019-12-12 08:00:00 | {292,269,269,292}                                                                         | {292,269,269,292}
 687 | 2019-12-12 08:00:00 | {266,266}                                                                                 | {266,266}
 691 | 2019-12-12 08:00:00 | {588,588,294,360,294,360,364,364,323,647,323,647}                                         | {588,588,294,360,294,360,364,364,323,647,323,647}
 695 | 2019-12-12 08:00:00 | {276,276,288,639,640,552,614,552,614,639,640,288}                                         | {276,276,288,639,640,552,614,552,614,639,640,288}
 699 | 2019-12-12 08:00:00 | {251,251,257,264,257,264}                                                                 | {257,264,257,264}
 703 | 2019-12-12 08:00:00 | {638,565,566,641,638,641,565,566}                                                         | {251,251,638,565,566,641,638,641,565,566}
 707 | 2019-12-12 08:00:00 | {303,626,626,313,303,313}                                                                 | {303,626,626,313,303,313}
 711 | 2019-12-12 08:00:00 | {253,252,253,252,290,290,594,594}                                                         | {253,252,253,252,290,290,594,594}
 680 | 2019-12-12 09:40:00 | {633,633,660,660,572,635,635,572,659,659,653,653}                                         | {633,633,660,660,572,635,635,572,659,659}
 700 | 2019-12-12 09:40:00 | {306,332,279,306,332,279}                                                                 | {306,332,279,306,332,279,653,653}
 688 | 2019-12-12 09:50:00 | {308,652,308,652,295,646,318,646,318,295}                                                 | {308,652,308,652,295,646,318,646,318,295}
 708 | 2019-12-12 09:50:00 | {}                                                                                        | {}
 684 | 2019-12-12 10:30:00 | {666,666,661,574,661,574,662,662,353,353,289,289}                                         | {666,666,661,574,661,574,662,662,353,353}
 704 | 2019-12-12 10:30:00 | {307,307,596,333,596,333}                                                                 | {596,333,596,333}
 692 | 2019-12-12 10:50:00 | {657,657,637,309,637,309,648,648,567,365,365,567}                                         | {657,657,637,309,637,309,648,648,567,365,365,567}
 712 | 2019-12-12 10:50:00 | {497,497}                                                                                 | {307,307,497,289,497,289}
 696 | 2019-12-12 12:00:00 | {267,268,267,268,310,310,285,285}                                                         | {267,268,267,268,310,310,285,285}
 681 | 2019-12-12 13:00:00 | {498,589,589,663,498,663}                                                                 | {498,589,589,663,498,663}
 689 | 2019-12-12 13:00:00 | {261,261,314,355,314,355,667,475,475,667,513,277,513,277,433,478,433,478}                 | {261,261,314,355,314,355,475,475,513,664,277,513,664,277,433,478,433,478}
 701 | 2019-12-12 13:00:00 | {}                                                                                        | {}
 709 | 2019-12-12 13:00:00 | {}                                                                                        | {}
 697 | 2019-12-12 13:50:00 | {334,334}                                                                                 | {667,667,334,334}
 685 | 2019-12-12 14:00:00 | {664,664,356,356}                                                                         | {356,356}
 693 | 2019-12-12 14:00:00 | {514,515,516,515,516,514}                                                                 | {514,515,516,515,516,514}
 705 | 2019-12-12 14:00:00 | {265,265}                                                                                 | {265,265}
 713 | 2019-12-12 14:00:00 | {517,517}                                                                                 | {265,265,517,517}
 682 | 2019-12-12 15:20:00 | {299,436,263,436,299,263,525,525,532,354,532,354}                                         | {299,436,263,436,299,263,525,525,532,354,532,354}
 702 | 2019-12-12 15:20:00 | {491,296,357,357,491,262,296,262,534,534,278,280,278,280}                                 | {491,296,275,275,491,262,296,262,534,534,278,280,278,280}
 686 | 2019-12-12 15:30:00 | {287,287}                                                                                 | {287,287,357,357}
 690 | 2019-12-12 15:40:00 | {275,275,291,291}                                                                         | {291,291}
 710 | 2019-12-12 15:40:00 | {270,250,270,250,272,361,361,272}                                                         | {270,250,270,250,272,361,361,272}
 698 | 2019-12-12 15:50:00 | {249,249}                                                                                 | {254,416,249,254,416,249}
 706 | 2019-12-12 16:00:00 | {248,258,256,248,258,256}                                                                 | {248,258,256,248,258,256}
 694 | 2019-12-12 16:10:00 | {}                                                                                        | {}
 714 | 2019-12-12 16:10:00 | {254,416,254,416}                                                                         | {254,416,254,416}
 715 | 2019-12-13 08:00:00 | {450,408,395,452,450,395,408,452}                                                         | {450,408,395,452,450,395,408,452}
 719 | 2019-12-13 08:00:00 | {388,459,458,459,458,388,397,397,470,419,419,470,382,382}                                 | {388,459,458,459,458,388,397,397,470,419,419,470,382,382}
 723 | 2019-12-13 08:00:00 | {447,447,414,393,414,393}                                                                 | {447,447,393,393}
 727 | 2019-12-13 08:00:00 | {422,404,404,422,492,492,453,409,409,439,463,439,453,463}                                 | {422,404,404,422,492,492,453,409,409,439,463,439,453,463}
 731 | 2019-12-13 08:00:00 | {493,449,449,493,446,446,400,400,499,501,467,499,501,467}                                 | {493,449,449,493,446,414,446,400,400,414,499,501,467,499,501,467}
 735 | 2019-12-13 08:00:00 | {376,374,376,374}                                                                         | {376,374,376,374}
 739 | 2019-12-13 08:00:00 | {371,372,444,370,372,371,370,385,378,385,444,481,378,481,480,480}                         | {371,372,444,370,372,371,370,378,444,481,378,481,480,480}
 743 | 2019-12-13 08:00:00 | {420,420}                                                                                 | {420,420}
 747 | 2019-12-13 08:00:00 | {483,483,469,469}                                                                         | {483,420,483,385,385,420,402,402}
 716 | 2019-12-13 09:40:00 | {523,523,398,533,398,533}                                                                 | {523,523,398,533,398,533}
 736 | 2019-12-13 09:40:00 | {402,511,402,511,500,396,396,500}                                                         | {511,511,500,396,401,401,396,500}
 724 | 2019-12-13 09:50:00 | {451,451}                                                                                 | {451,451}
 744 | 2019-12-13 09:50:00 | {519,465,519,465,484,484}                                                                 | {519,469,465,469,519,465,484,484}
 720 | 2019-12-13 10:30:00 | {494,494,410,410,427,383,383,448,427,448,389,464,464,675,389,674,675,674}                 | {494,494,410,410,427,448,427,448,389,464,464,675,389,674,675,674}
 740 | 2019-12-13 10:30:00 | {401,401,445,524,524,445,651,651,656,656}                                                 | {445,383,383,524,524,445,651,651,656,656}
 728 | 2019-12-13 10:50:00 | {440,502,440,471,471,502,645,405,645,634,405,634,610,610}                                 | {440,502,440,471,471,502,645,405,645,634,405,634,610,610}
 748 | 2019-12-13 10:50:00 | {403,403,418,415,415,418,482,575,482,575,658,658}                                         | {403,403,418,415,415,418,482,575,482,575,658,658}
 732 | 2019-12-13 12:00:00 | {394,468,411,411,442,437,394,468,437,442,665,665,380,485,485,380}                         | {394,468,411,411,442,437,394,468,437,442,665,665,495,380,485,485,380,495}
 717 | 2019-12-13 13:00:00 | {649,412,649,509,509,412,384,384,455,455}                                                 | {649,412,649,509,509,412,454,454,455,455}
 725 | 2019-12-13 13:00:00 | {441,495,441,495,454,454,456,487,456,487,535,535,521,521}                                 | {441,441,456,384,384,456,535,535,521,521}
 737 | 2019-12-13 13:00:00 | {650,423,650,423}                                                                         | {650,423,650,423}
 745 | 2019-12-13 13:00:00 | {536,536,461,461,462,424,424,462}                                                         | {536,536,461,461,462,424,424,462}
 733 | 2019-12-13 13:50:00 | {438,443,438,443}                                                                         | {438,443,438,443}
 721 | 2019-12-13 14:00:00 | {529,529}                                                                                 | {529,487,487,529}
 729 | 2019-12-13 14:00:00 | {479,474,479,474}                                                                         | {479,474,479,474}
 741 | 2019-12-13 14:00:00 | {488,381,488,381}                                                                         | {488,381,488,381}
 749 | 2019-12-13 14:00:00 | {391,466,466,391}                                                                         | {391,466,466,391}
 718 | 2019-12-13 15:20:00 | {486,486,392,434,434,392,526,526,386,426,386,426}                                         | {486,486,392,434,434,392,526,526}
 738 | 2019-12-13 15:20:00 | {512,512,373,367,373,367}                                                                 | {512,512,386,386}
 722 | 2019-12-13 15:30:00 | {399,399,428,510,428,510}                                                                 | {399,399,510,510}
 726 | 2019-12-13 15:40:00 | {421,522,522,421}                                                                         | {421,522,522,421,426,426}
 746 | 2019-12-13 15:40:00 | {369,375,377,377,375,369}                                                                 | {367,369,375,377,367,377,375,369}
 734 | 2019-12-13 15:50:00 | {387,387,530,530,413,413,531,531}                                                         | {387,387,428,530,428,530,413,413,531,531}
 742 | 2019-12-13 16:00:00 | {417,368,417,368}                                                                         | {373,417,368,373,417,368}
 730 | 2019-12-13 16:10:00 | {}                                                                                        | {}
 750 | 2019-12-13 16:10:00 | {}                                                                                        | {}
(144 rows)

ROLLBACK;
ROLLBACK
