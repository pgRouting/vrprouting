BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
SET search_path TO 'example2', 'public';
SET
UPDATE vehicles
    SET stops = NULL;
UPDATE 180
SELECT * FROM shipments
WHERE id IN (73, 93, 203, 219, 302, 425, 505, 507, 508)
ORDER BY id;
 id  | amount |     p_id      |      p_tw_open      |     p_tw_close      | p_t_service |     d_id      |         d_tw_open          |         d_tw_close         | d_t_service |   p_open   |  p_close   | p_service |   d_open   |  d_close   | d_service | multiplier |        booking_date
-----+--------+---------------+---------------------+---------------------+-------------+---------------+----------------------------+----------------------------+-------------+------------+------------+-----------+------------+------------+-----------+------------+----------------------------
  73 |      1 | 3613481403169 | 2019-12-09 10:00:00 | 2019-12-09 10:20:00 | 00:00:00    | 3618791402920 | 2019-12-09 10:12:36.442156 | 2019-12-09 10:42:56.724725 | 00:00:00    | 1575885600 | 1575886800 |         0 | 1575886356 | 1575888177 |         0 |        1.3 | 2019-12-03 07:09:09.730552
  93 |      1 | 3618151403079 | 2019-12-09 15:00:00 | 2019-12-09 15:20:00 | 00:00:00    | 3623001402477 | 2019-12-09 15:15:16.02545  | 2019-12-09 15:47:47.166319 | 00:00:00    | 1575903600 | 1575904800 |         0 | 1575904516 | 1575906467 |         0 |        1.2 | 2019-12-03 07:44:36.398735
 203 |      1 | 3620691402610 | 2019-12-11 10:00:00 | 2019-12-11 10:20:00 | 00:00:00    | 3622251402693 | 2019-12-11 10:03:46.206842 | 2019-12-11 10:26:51.696453 | 00:00:00    | 1576058400 | 1576059600 |         0 | 1576058626 | 1576060012 |         0 |        1.3 | 2019-12-04 01:04:13.737657
 219 |      1 | 3619081402798 | 2019-12-09 15:00:00 | 2019-12-09 15:20:00 | 00:00:00    | 3619611402670 | 2019-12-09 15:02:35.133883 | 2019-12-09 15:24:42.343667 | 00:00:00    | 1575903600 | 1575904800 |         0 | 1575903755 | 1575905082 |         0 |        1.2 | 2019-12-04 04:44:36.203209
 302 |      1 | 3614971402781 | 2019-12-09 10:00:00 | 2019-12-09 10:20:00 | 00:00:00    | 3616211403024 | 2019-12-09 10:05:10.024033 | 2019-12-09 10:29:24.243741 | 00:00:00    | 1575885600 | 1575886800 |         0 | 1575885910 | 1575887364 |         0 |        1.3 | 2019-12-05 01:18:36.008486
 425 |      1 | 3618641402722 | 2019-12-09 14:00:00 | 2019-12-09 14:20:00 | 00:00:00    | 3618151402832 | 2019-12-09 14:02:15.484283 | 2019-12-09 14:24:06.581396 | 00:00:00    | 1575900000 | 1575901200 |         0 | 1575900135 | 1575901447 |         0 |        1.2 | 2019-12-06 00:56:20.951084
 505 |      1 | 3618671402855 | 2019-12-09 14:00:00 | 2019-12-09 14:20:00 | 00:00:00    | 3619091402880 | 2019-12-09 14:01:02.094923 | 2019-12-09 14:21:53.012761 | 00:00:00    | 1575900000 | 1575901200 |         0 | 1575900062 | 1575901313 |         0 |        1.2 | 2019-12-06 05:51:15.543987
 507 |      1 | 3618671402855 | 2019-12-09 14:00:00 | 2019-12-09 14:20:00 | 00:00:00    | 3619091402880 | 2019-12-09 14:01:02.094923 | 2019-12-09 14:21:53.012761 | 00:00:00    | 1575900000 | 1575901200 |         0 | 1575900062 | 1575901313 |         0 |        1.2 | 2019-12-06 05:54:24.886416
 508 |      1 | 3618791402920 | 2019-12-09 14:00:00 | 2019-12-09 14:20:00 | 00:00:00    | 3619401402840 | 2019-12-09 14:01:58.547074 | 2019-12-09 14:23:35.755675 | 00:00:00    | 1575900000 | 1575901200 |         0 | 1575900119 | 1575901416 |         0 |        1.2 | 2019-12-06 06:03:13.693134
(9 rows)

UPDATE shipments
SET p_t_service = '00:01:00',
    d_t_service = '00:02:00';
UPDATE 676
/*******
Creating a fix initial solution
*******/
UPDATE vehicles AS v
SET stops = ARRAY[302, 73, 302, 73]
WHERE v.id = 580;
UPDATE 1
UPDATE vehicles AS v
SET stops = ARRAY[425,425,505,507,508,505,507,508,93,219,219,203,203,93]
WHERE v.id = 585;
UPDATE 1
SELECT id, stops
FROM vehicles
WHERE id IN (580, 699, 585)
ORDER BY id;
 id  |                          stops
-----+---------------------------------------------------------
 580 | {302,73,302,73}
 585 | {425,425,505,507,508,505,507,508,93,219,219,203,203,93}
 699 |
(3 rows)

SELECT *, id_to_geom(stop_id) AS location
FROM vrp_viewRouteRaw(
    $$SELECT * FROM shipments$$::TEXT,
    $$SELECT * FROM vehicles$$::TEXT,
    $$SELECT start_vid, end_vid, agg_cost FROM timeMatrix$$::TEXT,
    $$SELECT * FROM tdm_raw('2019-12-09'::TIMESTAMP, '2019-12-13'::TIMESTAMP)$$::TEXT,
    580::BIGINT, factor => 1.0::float);
 seq | vehicle_seq | vehicle_id | stop_seq | stop_type |    stop_id    | order_id | cargo | travel_fd | arrival_ft | wait_fd | schedule_ft | service_fd | departure_ft | cvtot | twvtot |                      location
-----+-------------+------------+----------+-----------+---------------+----------+-------+-----------+------------+---------+-------------+------------+--------------+-------+--------+----------------------------------------------------
   1 |           1 |        580 |        1 |         1 | 3619121402769 |       -1 |     0 |         0 | 1575885000 |       0 |  1575885000 |          0 |   1575885000 |     0 |      0 | 0101000020E61000006688635DDC886140637FD93D79184240
   2 |           1 |        580 |        2 |         2 | 3614971402781 |      302 |     1 |       720 | 1575885720 |       0 |  1575885720 |         60 |   1575885780 |     0 |      0 | 0101000020E610000090A0F831E6886140091B9E5E29134240
   3 |           1 |        580 |        3 |         2 | 3613481403169 |       73 |     2 |       715 | 1575886495 |       0 |  1575886495 |         60 |   1575886555 |     0 |      0 | 0101000020E61000004703780B248A61401AC05B2041114240
   4 |           1 |        580 |        4 |         3 | 3616211403024 |      302 |     1 |       531 | 1575887086 |       0 |  1575887086 |        120 |   1575887206 |     0 |      0 | 0101000020E6100000EFC9C342AD8961403F575BB1BF144240
   5 |           1 |        580 |        5 |         3 | 3618791402920 |       73 |     0 |       616 | 1575887822 |       0 |  1575887822 |        120 |   1575887942 |     0 |      0 | 0101000020E6100000D34D6210588961408E75711B0D184240
   6 |           1 |        580 |        6 |         6 | 3619121402769 |       -1 |     0 |       305 | 1575888247 |       0 |  1575888247 |          0 |   1575888247 |     0 |      0 | 0101000020E61000006688635DDC886140637FD93D79184240
(6 rows)

SELECT *, id_to_geom(stop_id) AS location
FROM vrp_viewRouteRaw(
    $$SELECT * FROM shipments$$,
    $$SELECT * FROM vehicles$$,
    $$SELECT start_vid, end_vid, agg_cost FROM timeMatrix$$,
    $$SELECT * FROM tdm_raw('2019-12-09'::TIMESTAMP, '2019-12-13'::TIMESTAMP)$$,
    699::BIGINT, factor => 1.0::float);
NOTICE:  Insufficient data found on 'orders' inner query
HINT:
          WITH
            __shipments AS (SELECT * FROM shipments),
            __vehicles AS (SELECT * FROM vehicles)
          SELECT * FROM __shipments
          WHERE id IN (SELECT distinct(unnest(stops)) FROM  __vehicles v WHERE id = 699)

 seq | vehicle_seq | vehicle_id | stop_seq | stop_type | stop_id | order_id | cargo | travel_fd | arrival_ft | wait_fd | schedule_ft | service_fd | departure_ft | cvtot | twvtot | location
-----+-------------+------------+----------+-----------+---------+----------+-------+-----------+------------+---------+-------------+------------+--------------+-------+--------+----------
(0 rows)

SELECT *, id_to_geom(stop_id) AS location
FROM vrp_viewRouteRaw(
    $$SELECT * FROM shipments$$,
    $$SELECT * FROM vehicles$$,
    $$SELECT start_vid, end_vid, agg_cost FROM timeMatrix$$,
    $$SELECT * FROM tdm_raw('2019-12-09'::TIMESTAMP, '2019-12-13'::TIMESTAMP)$$,
    585::BIGINT, factor => 1.0::float);
 seq | vehicle_seq | vehicle_id | stop_seq | stop_type |    stop_id    | order_id | cargo | travel_fd | arrival_ft | wait_fd | schedule_ft | service_fd | departure_ft | cvtot | twvtot |                      location
-----+-------------+------------+----------+-----------+---------------+----------+-------+-----------+------------+---------+-------------+------------+--------------+-------+--------+----------------------------------------------------
   1 |           1 |        585 |        1 |         1 | 3619121402769 |       -1 |     0 |         0 | 1575900000 |       0 |  1575900000 |          0 |   1575900000 |     0 |      0 | 0101000020E61000006688635DDC886140637FD93D79184240
   2 |           1 |        585 |        2 |         2 | 3618641402722 |      425 |     1 |       110 | 1575900110 |       0 |  1575900110 |         60 |   1575900170 |     0 |      0 | 0101000020E6100000143FC6DCB5886140B9FC87F4DB174240
   3 |           1 |        585 |        3 |         3 | 3618151402832 |      425 |     0 |       183 | 1575900353 |       0 |  1575900353 |        120 |   1575900473 |     0 |      0 | 0101000020E6100000454772F90F896140AC1C5A643B174240
   4 |           1 |        585 |        4 |         2 | 3618671402855 |      505 |     1 |       213 | 1575900686 |       0 |  1575900686 |         60 |   1575900746 |     0 |      0 | 0101000020E61000004260E5D022896140E4141DC9E5174240
   5 |           1 |        585 |        5 |         2 | 3618671402855 |      507 |     2 |         0 | 1575900746 |       0 |  1575900746 |         60 |   1575900806 |     0 |      0 | 0101000020E61000004260E5D022896140E4141DC9E5174240
   6 |           1 |        585 |        6 |         2 | 3618791402920 |      508 |     3 |       151 | 1575900957 |       0 |  1575900957 |         60 |   1575901017 |     0 |      0 | 0101000020E6100000D34D6210588961408E75711B0D184240
   7 |           1 |        585 |        7 |         3 | 3619091402880 |      505 |     2 |       186 | 1575901203 |       0 |  1575901203 |        120 |   1575901323 |     0 |      0 | 0101000020E6100000F0A7C64B37896140386744696F184240
   8 |           1 |        585 |        8 |         3 | 3619091402880 |      507 |     1 |         0 | 1575901323 |       0 |  1575901323 |        120 |   1575901443 |     0 |      1 | 0101000020E6100000F0A7C64B37896140386744696F184240
   9 |           1 |        585 |        9 |         3 | 3619401402840 |      508 |     0 |       198 | 1575901641 |       0 |  1575901641 |        120 |   1575901761 |     0 |      2 | 0101000020E61000000C022B871689614046B6F3FDD4184240
  10 |           1 |        585 |       10 |         2 | 3618151403079 |       93 |     1 |       363 | 1575902124 |    1476 |  1575903600 |         60 |   1575903660 |     0 |      2 | 0101000020E610000007CE1951DA896140AC1C5A643B174240
  11 |           1 |        585 |       11 |         2 | 3619081402798 |      219 |     2 |       306 | 1575903966 |       0 |  1575903966 |         60 |   1575904026 |     0 |      2 | 0101000020E6100000772D211FF4886140D50968226C184240
  12 |           1 |        585 |       12 |         3 | 3619611402670 |      219 |     1 |       337 | 1575904363 |       0 |  1575904363 |        120 |   1575904483 |     0 |      2 | 0101000020E6100000068195438B886140705F07CE19194240
  13 |           1 |        585 |       13 |         2 | 3620691402610 |      203 |     2 |       284 | 1575904767 |  153633 |  1576058400 |         60 |   1576058460 |     0 |      2 | 0101000020E61000003108AC1C5A8861406DC5FEB27B1A4240
  14 |           1 |        585 |       14 |         3 | 3622251402693 |      203 |     1 |       321 | 1576058781 |       0 |  1576058781 |        120 |   1576058901 |     0 |      2 | 0101000020E6100000029A081B9E88614014AE47E17A1C4240
  15 |           1 |        585 |       15 |         3 | 3623001402477 |       93 |     0 |       507 | 1576059408 |       0 |  1576059408 |        120 |   1576059528 |     0 |      3 | 0101000020E610000004E78C28ED8761403D0AD7A3701D4240
  16 |           1 |        585 |       16 |         6 | 3619121402769 |       -1 |     0 |       751 | 1576060279 |       0 |  1576060279 |          0 |   1576060279 |     0 |      4 | 0101000020E61000006688635DDC886140637FD93D79184240
(16 rows)

ROLLBACK;
ROLLBACK
